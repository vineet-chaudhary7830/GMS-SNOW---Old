<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($scope, $timeout) {
  var c = this;
	c.data = {};

  c.takePhoto = function() {
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
      .then(function(stream) {
        const video = document.createElement('video');
        const canvas = document.createElement('canvas');
        video.style.display = 'none';
        canvas.style.display = 'none';
        document.body.appendChild(video);
        document.body.appendChild(canvas);

        video.srcObject = stream;
        video.play();

        $timeout(function() {
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

          stream.getTracks().forEach(track => track.stop());

          const dataUrl = canvas.toDataURL('image/png');
          const base64Image = dataUrl.split(',')[1];

          document.body.removeChild(video);
          document.body.removeChild(canvas);

          // Send to server
          c.data.imageNewData = base64Image;
          c.data.action = 'updateImage';
          c.server.update().then(function(response) {
            console.log("âœ… Server response:", response);
          });
        }, 1000);
      })
      .catch(function(err) {
        console.error("âŒ Error accessing camera:", err);
      });
  };
};]]></client_script>
        <controller_as>c</controller_as>
        <css>body {
    font-family: 'Inter', sans-serif;
    background-color: #f3f4f6;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 1rem;
}

/* Utility for messages */
.message-box {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 1rem 2rem;
    border-radius: 0.5rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    color: white;
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
    text-align: center;
}
.message-box.show {
    opacity: 1;
}

/* Main Form Container */
.form-container {
    width: 100%;
    max-width: 48rem; /* Equivalent to max-w-2xl */
    background-color: #ffffff;
    border-radius: 0.75rem; /* Equivalent to rounded-xl */
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* Equivalent to shadow-2xl */
    padding: 2.5rem; /* Equivalent to p-10 */
    border: 1px solid #e5e7eb;
}
@media (max-width: 768px) {
    .form-container {
        padding: 1.5rem; /* Equivalent to p-6 */
    }
}

/* Section Styling */
.form-section {
    margin-bottom: 2rem;
    padding: 1.5rem;
    border-radius: 0.5rem;
    border-width: 1px;
}
.checkin-section { background-color: #eff6ff; border-color: #bfdbfe; } /* bg-blue-50, border-blue-200 */
.camera-section { background-color: #faf5ff; border-color: #e9d5ff; } /* bg-purple-50, border-purple-200 */
.checkout-section { background-color: #ecfdf5; border-color: #a7f3d0; } /* bg-emerald-50, border-emerald-200 */
.text-center { text-align: center; }

/* Headings */
.main-heading {
    font-size: 1.875rem; /* text-3xl */
    font-weight: 700; /* font-bold */
    color: #1f2937; /* text-gray-800 */
    text-align: center;
    margin-bottom: 1.5rem;
}
.section-heading {
    font-size: 1.25rem; /* text-xl */
    font-weight: 600; /* font-semibold */
    color: #374151; /* text-gray-700 */
    margin-bottom: 1rem;
}

/* Flexbox utilities */
.flex-row-center {
    display: flex;
    align-items: center;
    gap: 1rem;
}
.flex-col-md-row {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
}
@media (min-width: 768px) {
    .flex-col-md-row {
        flex-direction: row;
    }
}
.camera-controls {
    margin-top: 1rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 1rem;
}
@media (min-width: 640px) {
    .camera-controls {
        flex-direction: row;
    }
}

/* Video/Image Containers */
.video-container, .photo-preview-container {
    width: 100%;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border: 1px solid #d1d5db;
}
@media (min-width: 768px) {
    .video-container, .photo-preview-container {
        width: 50%;
    }
}

/* Buttons */
.button {
    color: #ffffff;
    font-weight: 600;
    padding: 0.5rem 1.5rem;
    border-radius: 0.5rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease-in-out;
    transform: scale(1);
}
.button:hover {
    transform: scale(1.05);
}
.checkin-button { background-color: #2563eb; }
.checkin-button:hover { background-color: #1d4ed8; }
.checkout-button { background-color: #10b981; }
.checkout-button:hover { background-color: #059669; }
.camera-button { background-color: #9333ea; }
.camera-button:hover { background-color: #7e22ce; }
.submit-button { 
    background-color: #1f2937; 
    font-weight: 700; 
    padding: 0.75rem 3rem; 
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-xl */
}
.submit-button:hover { background-color: #374151; }

/* Other elements */
.time-display {
    color: #4b5563;
    font-size: 1.125rem; /* text-lg */
    font-weight: 500; /* font-medium */
}
</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id/>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>Face Capture Widget</name>
        <option_schema/>
        <public>true</public>
        <roles/>
        <script><![CDATA[(function() {
  if (input && input.action == 'updateImage') {
    var rdata = input.imageNewData;

    var gr = new GlideRecord('x_1606613_gym_ma_0_gym_attend');
    gr.addQuery('sys_id', 'b291b39883f7a210ed9bfe55eeaad30b');
    gr.query();
    if (gr.next()) {
      var attendeeName = gr.getDisplayValue('gym_member');
      var dateStr = new GlideDateTime().getLocalDate().toString(); // Format: yyyy-MM-dd

      var fileName = attendeeName + '_' + dateStr + '.png';
      var contentType = 'image/png';

      var sa = new GlideSysAttachment();
      var attachmentSysId = sa.writeBase64(gr, fileName, contentType, rdata);

     // gr.photo = attachmentSysId; // or image URL if needed
				gr.user_phto = attachmentSysId;
      gr.update();

      return { status: "Success", fileName: fileName };
    } else {
      return { status: "Failure", message: "Record not found" };
    }
  }
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-09-01 11:41:50</sys_created_on>
        <sys_id>3e5d8e5883ff6210ed9bfe55eeaad397</sys_id>
        <sys_mod_count>50</sys_mod_count>
        <sys_name>Face Capture Widget</sys_name>
        <sys_package display_value="GYM Management Application" source="x_1606613_gym_ma_0">e737c57383632210ed9bfe55eeaad3ee</sys_package>
        <sys_policy/>
        <sys_scope display_value="GYM Management Application">e737c57383632210ed9bfe55eeaad3ee</sys_scope>
        <sys_update_name>sp_widget_3e5d8e5883ff6210ed9bfe55eeaad397</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-09-02 06:48:26</sys_updated_on>
        <template><![CDATA[<div class="text-center">
  <button class="btn btn-primary" ng-click="c.takePhoto()">]]>ðŸ“·<![CDATA[ Take Photo</button>
</div>
]]></template>
    </sp_widget>
</record_update>
